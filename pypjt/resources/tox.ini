[tox]
requires =
    tox>=4
env_list =
    format
    type
    py31{3,2,1,0}

[testenv]
description = Run tests with coverage and pytest
deps =
    -r requirements/dev.txt
    -c requirements/constraints.txt
skip_install = true
allowlist_externals =
    ./scripts/*
commands =
    coverage run -m pytest tests --junitxml=junit.xml --no-header -q --capture=fd --ignore=./tests/tmp
    coverage html -d htmlcov/{envname}

[testenv:py313]
commands =
    coverage run -m pytest tests --junitxml=junit.xml --capture=tee-sys --ignore=./tests/tmp --basetemp=./tests/tmp
    coverage report -m
    coverage html -d htmlcov/{envname}
    python ./scripts/lib/htmlcov_link.py

[testenv:type]
description = Run mypy for checking type
commands =
    mypy {{project_name}}
    mypy tests

[testenv:format]
description = Run ruff for code check and formatting
deps =
    ruff
commands =
    ruff --config ./pyproject.toml format {{project_name}}
    ruff --config ./pyproject.toml format tests
    ruff --config ./pyproject.toml check {{project_name}} --fix
    ruff --config ./pyproject.toml check tests --fix
